name: Deploy Nuxt.js to GitHub Pages

on:
  push:
    branches:
      - main  # Trigger on push to the main branch

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    # Checkout the repository
    - name: Checkout code
      uses: actions/checkout@v3

    # Set up Node.js environment
    - name: Set up Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '16'  # Specify the Node.js version

    # Install dependencies
    - name: Install dependencies
      run: npm install

    # Build the Nuxt.js project
    - name: Build the project
      run: npm run build

    # List the contents of the directory for debugging
    - name: List files in the directory
      run: ls -alh

    # Upload the build artifact
    - name: Upload artifact for deployment
      uses: actions/upload-artifact@v3
      with:
        name: github-pages
        path: .nuxt  # Adjust this path if your build output is in a different directory
        if-no-files-found: warn
        include-hidden-files: false

  deploy:
    runs-on: ubuntu-latest
    needs: build  # Ensure the build job completes first

    steps:
    # Checkout the repository again
    - name: Checkout code
      uses: actions/checkout@v3

    # Download the artifact
    - name: Download artifact
      uses: actions/download-artifact@v3
      with:
        name: github-pages

    # Set up Git configuration
    - name: Set up Git config
      run: |
        git config user.name "GitHub Actions"
        git config user.email "github-actions@github.com"

    # Set up deployment branch (you can choose 'gh-pages' or 'main')
    - name: Set up deployment branch
      run: |
        git checkout -b gh-pages || git checkout gh-pages

    # Copy the build output to the deployment directory
    - name: Copy build output to deployment branch
      run: |
        cp -r .nuxt/* .

    # Commit the changes to the deployment branch
    - name: Commit and push changes
      run: |
        git add .
        git commit -m "Deploy to GitHub Pages"
        git push --force origin gh-pages

    # Set up GitHub Pages deployment
    - name: Deploy to GitHub Pages
      uses: JamesIves/github-pages-deploy-action@v4
      with:
        branch: gh-pages  # The branch where your GitHub Pages will be deployed
        folder: .  # The folder to deploy, which should be the root of the output

